<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8" />
<title>æ¯”è³½å³æ™‚ç‹€æ…‹</title>
<style>
body {
  margin:0;
  font-family:system-ui,-apple-system;
  background:#0f0f0f;
  color:#eee;
}
.topbar{
  display:flex;
  gap:8px;
  padding:8px 12px;
  background:#111;
  border-bottom:1px solid #333;
}
button{
  background:#333;
  color:#fff;
  border:none;
  border-radius:6px;
  padding:6px 10px;
  cursor:pointer;
}
button.active{background:#2ecc71;color:#000;}
.container{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
  padding:12px;
}
.panel{
  background:#1b1b1b;
  border-radius:10px;
  padding:12px;
  overflow-y:auto;
  max-height:calc(100vh - 70px);
}
h2{margin:0 0 8px;font-size:18px}

.team{border:1px solid #333;border-radius:8px;padding:8px;margin-bottom:8px}
.member{display:inline-block;padding:4px 8px;margin:3px;border-radius:6px;font-weight:bold}
.green{background:#2ecc71;color:#000}
.yellow{background:#f1c40f;color:#000}
.red{background:#e74c3c;color:#000}

.event{border-bottom:1px solid #333;padding-bottom:8px;margin-bottom:10px}
.teamline{margin-left:10px;margin-top:4px}
.ok{color:#2ecc71;font-weight:bold}
.miss{color:#e74c3c;font-weight:bold}
.small{font-size:13px;opacity:.9}

#debug{
  white-space:pre-wrap;
  font-size:12px;
  background:#000;
  color:#0f0;
  padding:8px;
  margin:12px;
  border-radius:6px;
  display:none;
}
.notice{
  padding:12px;
  color:#f1c40f;
}
</style>
</head>
<body>

<div class="topbar">
  <button id="normalBtn">ä¸€èˆ¬æ¨¡å¼</button>
  <button id="judgeBtn">è£åˆ¤æ¨¡å¼</button>
  <button id="debugBtn">Debug</button>
</div>

<div class="container" id="layout">
  <div class="panel" id="teamView">
    <h2>ğŸ å°éšŠå³æ™‚ç‹€æ…‹</h2>
    <div id="teams"></div>
  </div>
  <div class="panel">
    <h2>ğŸ¯ æ¯”è³½é …ç›®</h2>
    <div id="events"></div>
  </div>
</div>

<pre id="debug"></pre>

<script>
/* ===== è¨­å®š ===== */
const CSV_URL = "PUT_YOUR_PUBLISHED_CSV_URL_HERE";

/* ===== æ¨¡å¼ç‹€æ…‹ ===== */
let isJudge = false;
let showDebug = false;

/* ===== UI ===== */
const normalBtn=document.getElementById("normalBtn");
const judgeBtn=document.getElementById("judgeBtn");
const debugBtn=document.getElementById("debugBtn");
const debugBox=document.getElementById("debug");
const teamView=document.getElementById("teamView");
const layout=document.getElementById("layout");

function updateMode(){
  normalBtn.classList.toggle("active",!isJudge);
  judgeBtn.classList.toggle("active",isJudge);
  teamView.style.display = isJudge ? "none":"block";
  layout.style.gridTemplateColumns = isJudge?"1fr":"1fr 1fr";
}
normalBtn.onclick=()=>{isJudge=false;updateMode()};
judgeBtn.onclick=()=>{isJudge=true;updateMode()};
debugBtn.onclick=()=>{
  showDebug=!showDebug;
  debugBox.style.display=showDebug?"block":"none";
};

updateMode();

/* ===== Google Form TSV Parser ===== */
function parseTSV(text){
  const lines=text.trim().split(/\r?\n/);
  const headers=lines[0].split("\t").map(h=>h.trim());
  return lines.slice(1).map(line=>{
    const cols=line.split("\t");
    const obj={};
    headers.forEach((h,i)=>obj[h]= (cols[i]||"").trim());
    return obj;
  });
}

/* ===== ä¸»æµç¨‹ ===== */
fetch(CSV_URL).then(r=>r.text()).then(text=>{
  const rows=parseTSV(text);
  debugBox.textContent = "ROWS:\n"+JSON.stringify(rows.slice(0,5),null,2);

  if(rows.length===0){
    document.getElementById("teams").innerHTML =
      `<div class="notice">âš ï¸ CSV è§£æå¾Œæ²’æœ‰ä»»ä½•è³‡æ–™</div>`;
    return;
  }

  const latest={}, events=new Set();

  rows.forEach(r=>{
    const raw=r["æˆå“¡ ID"];
    const item=r["ç°½åˆ°é …ç›®"];
    if(!raw||raw.length<3||!item) return;

    const team=raw.slice(0,2);
    const member=raw.slice(2);

    latest[team]??={all:new Set(),checkin:new Set(),events:{}};
    latest[team].all.add(member);

    if(item==="é¦–æ¬¡å ±åˆ°"){
      latest[team].checkin.add(member);
    }else{
      latest[team].events[item]??=new Set();
      latest[team].events[item].add(member);
      events.add(item);
    }
  });

  /* ===== å°éšŠ ===== */
  const teamBox=document.getElementById("teams");
  Object.keys(latest).sort().forEach(team=>{
    const t=latest[team];
    const div=document.createElement("div");
    div.className="team";
    div.innerHTML=`<b>éšŠä¼ ${team}</b><br/>`;
    t.all.forEach(m=>{
      const checked=t.checkin.has(m);
      const played=Object.values(t.events).some(s=>s.has(m));
      let c="red";
      if(checked&&played)c="green";
      else if(!checked&&played)c="yellow";
      div.innerHTML+=`<span class="member ${c}">${m}</span>`;
    });
    teamBox.appendChild(div);
  });

  /* ===== é …ç›® ===== */
  const evBox=document.getElementById("events");
  events.forEach(ev=>{
    const evDiv=document.createElement("div");
    evDiv.className="event";
    evDiv.innerHTML=`<b>${ev}</b>`;
    Object.keys(latest).sort().forEach(team=>{
      const t=latest[team];
      if(!t.events[ev])return;
      const signed=[...t.events[ev]];
      const missing=[...t.all].filter(m=>!signed.includes(m));
      const line=document.createElement("div");
      line.className="teamline";
      line.innerHTML=signed.length===6
        ?`éšŠä¼ ${team}ï¼š<span class="ok">6/6 âœ…</span>`
        :`éšŠä¼ ${team}ï¼š${signed.length}/6<br>
           <span class="ok small">âœ… ${signed.join(" ")}</span><br>
           <span class="miss small">âŒ ${missing.join(" ")}</span>`;
      evDiv.appendChild(line);
    });
    evBox.appendChild(evDiv);
  });
});
</script>

</body>
</html>